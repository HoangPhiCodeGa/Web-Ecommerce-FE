<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta http-equiv="content-type" content="text/html;charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trang Thanh Toán</title>
    <link rel="stylesheet" href="path_to_your_css_file.css"> <!-- Include your stylesheet -->
    <!-- Favicon -->
    <link rel="apple-touch-icon" sizes="180x180" th:href="@{images/icons/apple-touch-icon.png}">
    <link rel="icon" type="image/png" sizes="32x32" th:href="@{images/icons/favicon-32x32.png}">
    <link rel="icon" type="image/png" sizes="16x16" th:href="@{images/icons/favicon-16x16.png}">
    <link rel="manifest" th:href="@{images/icons/site.html}">
    <link rel="mask-icon" th:href="@{images/icons/safari-pinned-tab.svg}" color="#666666">
    <link rel="shortcut icon" th:href="@{images/icons/favicon.ico}">
    <meta name="apple-mobile-web-app-title" content="Molla">
    <meta name="application-name" content="Molla">
    <meta name="msapplication-TileColor" content="#cc9966">
    <meta name="msapplication-config" content="assets/images/icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <!-- Plugins CSS File -->
    <link rel="stylesheet" th:href="@{fe/css/bootstrap.min.css}">
    <!-- Main CSS File -->
    <link rel="stylesheet" th:href="@{fe/css/style.css}">
    <link rel="stylesheet" th:href="@{fe/css/plugins/owl-carousel/owl.carousel.css}">
    <link rel="stylesheet" th:href="@{fe/css/plugins/magnific-popup/magnific-popup.css}">
    <link rel="stylesheet" th:href="@{fe/css/plugins/nouislider/nouislider.css}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
</head>

<body>
    <div class="page-wrapper">
        <header th:replace="~{user/fragments/navbar :: navbar}"></header>

        <main class="main">
            <div class="page-header text-center" style="background-image: url('path_to_background_image')">
                <div class="container">
                    <h1 class="page-title">ABCSZ Shop</h1>
                </div>
            </div>

            <nav aria-label="breadcrumb" class="breadcrumb-nav">
                <div class="container">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a th:href="@{/static}">Trang Chủ</a></li>
                        <li class="breadcrumb-item"><a th:href="@{/cart}">Giỏ hàng</a></li>
                        <li class="breadcrumb-item active" aria-current="page">Thanh toán</li>
                    </ol>
                </div>
            </nav>

            <div class="page-content">
                <div class="checkout">
                    <div class="container">
                        <form id="checkoutValidate" action="/path_to_checkout_processing" method="POST">
                            <!-- Hiển thị thông tin giỏ hàng -->
                            <div class="row">
                                <div class="col-lg-9">
                                    <h2 class="checkout-title">Thông tin giao hàng</h2>

                                    <!-- Thông tin khách hàng -->
                                    <div class="row">
                                        <div class="col-sm-12">
                                            <input name="name" placeholder="Họ và tên" type="text" class="form-control"
                                                required>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-sm-6">
                                            <input name="email" placeholder="Email" type="text" class="form-control"
                                                required>
                                        </div>
                                        <div class="col-sm-6">
                                            <input name="phone" placeholder="Số điện thoại" type="text"
                                                class="form-control" required>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-sm-4">
                                            <div class="select-custom">
                                                <select name="province_id" class="form-control province location"
                                                    required>
                                                    <option value="0">[Chọn Tỉnh/Thành Phố]</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-sm-4">
                                            <div class="select-custom">
                                                <select name="district_id" class="form-control districts location"
                                                    required>
                                                    <option value="0">[Chọn Quận/Huyện]</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-sm-4">
                                            <div class="select-custom">
                                                <select name="ward_id" class="form-control wards" required>
                                                    <option value="0">[Chọn Phường/Xã]</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>

                                    <input name="address" placeholder="Địa chỉ cụ thể" type="text" class="form-control"
                                        required>

                                    <div>
                                        <label>Ghi chú đơn hàng</label>
                                        <textarea name="note" class="form-control" cols="30" rows="4"
                                            placeholder="Ghi chú cho shop hoặc người giao hàng"></textarea>
                                    </div>

                                    <!-- Phương thức thanh toán -->
                                    <div class="row">
                                        <div class="col-sm-12">
                                            <div class="select-custom">
                                                <select name="methodPayment" class="form-control" required>
                                                    <option value="0">[Chọn Hình Thức Thanh Toán]</option>
                                                    <option value="VISA">Thanh toán bằng VISA</option>
                                                    <option value="MASTERCARD">Thanh toán bằng MasterCard/Thẻ Nội địa
                                                    </option>
                                                    <option value="CREDIT_CARD">Thanh toán bằng thẻ tín dụng</option>
                                                    <option value="COD">Thanh toán khi nhận hàng (COD)</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Sidebar hiển thị đơn hàng -->
                                <aside class="col-lg-3">
                                    <div class="summary">
                                        <h3 class="summary-title">Đơn hàng của bạn</h3>
                                        <table class="table table-summary">
                                            <tbody id="cart-summary">
                                                <!-- Các sản phẩm trong giỏ hàng -->
                                                <tr>
                                                    <td>Tổng tiền hàng:</td>
                                                    <td id="total-price">0 VND</td>
                                                </tr>
                                                <tr>
                                                    <td>Phí giao hàng:</td>
                                                    <td id="shipping-fee">0 VND</td>
                                                </tr>
                                                <tr>
                                                    <td>Tổng cộng:</td>
                                                    <td id="total-with-shipping">0 VND</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>

                                    <!-- Nút thanh toán -->
                                    <button type="button" onclick="checkout()"
                                        class="btn btn-outline-primary-2 btn-order btn-block checkout">
                                        <span class="btn-text">Đặt hàng</span>
                                    </button>
                                </aside>
                            </div>

                            <!-- Hiển thị sản phẩm trong giỏ hàng -->
                            <div class="table-responsive">
                                <table class="table table-cart">
                                    <thead>
                                        <tr>
                                            <th>Sản phẩm</th>
                                            <th>Size</th>
                                            <th>Giá sản phẩm</th>
                                            <th>Số lượng</th>
                                            <th>Thành tiền</th>
                                        </tr>
                                    </thead>
                                    <tbody id="cart-items-container">
                                        <!-- Các sản phẩm trong giỏ sẽ được hiển thị ở đây -->
                                    </tbody>
                                </table>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </main>

        <footer class="footer">
            <div class="container">
                <p class="footer-copyright">Copyright © 2024 ABCSZ Shop. All Rights Reserved.</p>
            </div>
        </footer>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/jwt-decode@3.1.2/build/jwt-decode.min.js"></script>
    <script src="/assets/custom/authen.js"></script>

    <script>
        // Giả lập thông tin giỏ hàng và cập nhật thông tin thanh toán

        function displayCart() {
            let total = 0;
            let cartItemsContainer = document.getElementById("cart-items-container");
            cartItemsContainer.innerHTML = "";

            cart.forEach(item => {
                total += item.price * item.quantity;
                cartItemsContainer.innerHTML += `
                    <tr>
                        <td>${item.name}</td>
                        <td>${item.size}</td>
                        <td>${item.price} VND</td>
                        <td>${item.quantity}</td>
                        <td>${item.price * item.quantity} VND</td>
                    </tr>
                `;
            });

            // Cập nhật tổng giá trị và phí giao hàng
            document.getElementById("total-price").innerText = total + " VND";
            let shippingFee = 30000; // Giả sử phí giao hàng cố định là 30.000 VND
            document.getElementById("shipping-fee").innerText = shippingFee + " VND";
            document.getElementById("total-with-shipping").innerText = total + shippingFee + " VND";
        }

        displayCart();
    </script>

    <script>
        // API URLs
        const provinceApiUrl = "https://open.oapi.vn/location/provinces?page=0&size=100";
        const districtApiUrl = "https://open.oapi.vn/location/districts/{idTinh}?page=0&size=100";
        const wardApiUrl = "https://open.oapi.vn/location/wards/{districtId}?page=0&size=100";

        // DOM elements for the selects
        const provinceSelect = document.querySelector("select[name='province_id']");
        const districtSelect = document.querySelector("select[name='district_id']");
        const wardSelect = document.querySelector("select[name='ward_id']");

        // Fetch provinces (Tỉnh/Thành phố)
        function fetchProvinces() {
            fetch(provinceApiUrl)
                .then(response => response.json())
                .then(data => {
                    const provinces = data.data;
                    provinceSelect.innerHTML = "<option value='0'>[Chọn Tỉnh/Thành Phố]</option>"; // Reset provinces
                    provinces.forEach(province => {
                        provinceSelect.innerHTML += `<option value="${province.id}">${province.name}</option>`;
                    });
                })
                .catch(error => console.error("Error fetching provinces:", error));
        }

        // Fetch districts (Quận/Huyện) based on the selected province
        function fetchDistricts(provinceId) {
            const url = districtApiUrl.replace("{idTinh}", provinceId);
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    const districts = data.data;
                    districtSelect.innerHTML = "<option value='0'>[Chọn Quận/Huyện]</option>"; // Reset districts
                    districts.forEach(district => {
                        districtSelect.innerHTML += `<option value="${district.id}">${district.name}</option>`;
                    });
                    wardSelect.innerHTML = "<option value='0'>[Chọn Phường/Xã]</option>"; // Reset wards when province changes
                })
                .catch(error => console.error("Error fetching districts:", error));
        }

        // Fetch wards (Phường/Xã) based on the selected district
        function fetchWards(districtId) {
            const url = wardApiUrl.replace("{districtId}", districtId);
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    const wards = data.data;
                    wardSelect.innerHTML = "<option value='0'>[Chọn Phường/Xã]</option>"; // Reset wards
                    wards.forEach(ward => {
                        wardSelect.innerHTML += `<option value="${ward.id}">${ward.name}</option>`;
                    });
                })
                .catch(error => console.error("Error fetching wards:", error));
        }

        // Event listener for when the province is selected
        provinceSelect.addEventListener("change", (event) => {
            const provinceId = event.target.value;
            if (provinceId !== "0") {
                fetchDistricts(provinceId);
            } else {
                districtSelect.innerHTML = "<option value='0'>[Chọn Quận/Huyện]</option>";
                wardSelect.innerHTML = "<option value='0'>[Chọn Phường/Xã]</option>";
            }
        });

        // Event listener for when the district is selected
        districtSelect.addEventListener("change", (event) => {
            const districtId = event.target.value;
            if (districtId !== "0") {
                fetchWards(districtId);
            } else {
                wardSelect.innerHTML = "<option value='0'>[Chọn Phường/Xã]</option>";
            }
        });

        // Initialize the provinces when the page loads
        document.addEventListener("DOMContentLoaded", fetchProvinces);
    </script>


    <script>
        function checkout() {
            var TOKEN_LOCAL = localStorage.getItem('TOKEN');
            console.log("token = ", TOKEN_LOCAL);
            const CONFIG_LOCAL = {
                headers: {
                    'Authorization': `Bearer ${TOKEN_LOCAL}`
                }
            };

            var data = {
                "ngayDatHang": "2024-05-09",
                "tongTien": 1500000,
                "status": "Chưa xử lý",
                "customerId": 1
            }

            var urlOrder = `http://localhost:9292/api/v1/orders/create`;




            axios.post(urlOrder, data, CONFIG_LOCAL)
                .then(function (response) {
                    Swal.fire({
                        icon: 'success',
                        title: 'Đặt hàng thành công!',
                        toast: true,
                        position: 'top-end',
                        showConfirmButton: false,
                        timer: 1500
                    });

                    setTimeout(function () {
                        window.location.href = '/index';
                    }, 1500);
                })
                .catch(function (error) {
                    console.error("Có lỗi xảy ra khi đặt hàng: ", error);
                    Swal.fire({
                        icon: 'error',
                        title: 'Đặt hàng thất bại!',
                        toast: true,
                        position: 'top-end',
                        showConfirmButton: false,
                        timer: 1500
                    });
                });
        }
    </script>
</body>

</html>