<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head th:replace="admin/fragments/head :: head"></head>

<body class="hold-transition sidebar-mini layout-fixed">
<div class="wrapper">
    <!-- Preloader -->
    <div class="preloader flex-column justify-content-center align-items-center">
        <img class="animation__shake" th:src="@{/assets/dist/img/AdminLTELogo.png}" alt="AdminLTELogo" height="60"
             width="60">
    </div>

    <!-- Navbar -->
    <nav th:replace="admin/fragments/navbar :: navbar"></nav>
    <!-- /.navbar -->

    <!-- Main Sidebar Container -->
    <aside th:replace="admin/fragments/sidebar :: sidebar"></aside>

    <!-- Content Wrapper. Contains page content -->
    <div class="content-wrapper">
        <!-- Content Header (Page header) -->
        <div class="content-header">
            <div class="container-fluid">
                <div class="row mb-2">
                    <div class="col-sm-6">
                        <h1 class="m-0">QUẢN LÝ ĐƠN HÀNG</h1>
                    </div><!-- /.col -->
                    <!--                    <div class="col-sm-6">-->
                    <!--                        <ol class="breadcrumb float-sm-right">-->
                    <!--                            <li class="breadcrumb-item"><a href="#">Quản lý đơn hàng</a></li>-->
                    <!--                            <li class="breadcrumb-item active">Dashboard v1</li>-->
                    <!--                        </ol>-->
                    <!--                    </div>-->
                </div>
            </div>
        </div>
        <!-- /.content-header -->

        <!-- Main content -->
        <section class="content">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <div class="row"
                                     style="display: flex;justify-content: space-between;align-items: center">
                                    <div class="col-md-5">
                                        <form>
                                            <div class="input-group">
                                                <input type="search" name="keyword" class="form-control"
                                                       placeholder="Type your keywords here">
                                                <div class="input-group-append">
                                                    <button type="submit" class="btn btn-default">
                                                        <i class="fa fa-search"></i>
                                                    </button>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                            <!-- /.card-header -->
                            <div class="card-body">
                                <div id="example2_wrapper" class="dataTables_wrapper dt-bootstrap4">
                                    <div class="row">
                                        <div class="col-sm-12 col-md-6"></div>
                                        <div class="col-sm-12 col-md-6"></div>
                                    </div>
                                    <div class="row">
                                        <div class="col-sm-12">
                                            <table id="example2"
                                                   class="table table-bordered table-hover dataTable dtr-inline"
                                                   aria-describedby="example2_info">
                                                <thead>
                                                <tr>
                                                    <th class="sorting sorting_asc" tabindex="0"
                                                        aria-controls="example2" rowspan="1" colspan="1"
                                                        aria-sort="ascending"
                                                        aria-label="Rendering engine: activate to sort column descending">
                                                        ID
                                                    </th>
                                                    <th class="sorting" tabindex="0" aria-controls="example2"
                                                        rowspan="1" colspan="1"
                                                        aria-label="Browser: activate to sort column ascending">
                                                        Ngày đặt hàng
                                                    </th>
                                                    <th class="sorting" tabindex="0" aria-controls="example2"
                                                        rowspan="1" colspan="1"
                                                        aria-label="Platform(s): activate to sort column ascending">
                                                        Tổng tiền
                                                    </th>
                                                    <th class="sorting" tabindex="0" aria-controls="example2"
                                                        rowspan="1" colspan="1"
                                                        aria-label="Engine version: activate to sort column ascending">
                                                        Trạng thái
                                                    </th>
                                                    <th class="sorting" tabindex="0" aria-controls="example2"
                                                        rowspan="1" colspan="1"
                                                        aria-label="CSS grade: activate to sort column ascending">
                                                        Khách hàng
                                                    </th>
                                                    <th class="sorting" tabindex="0" aria-controls="example2"
                                                        rowspan="1" colspan="1"
                                                        aria-label="CSS grade: activate to sort column ascending">
                                                        Khuyến mãi
                                                    </th>
                                                    <th class="sorting" tabindex="0" aria-controls="example2"
                                                        rowspan="1" colspan="1"
                                                        aria-label="CSS grade: activate to sort column ascending">
                                                        Action
                                                    </th>
                                                </tr>
                                                </thead>
                                                <tbody>
                                                <!-- Lặp danh sách orders-->
                                                <tr class="odd" th:each="order : ${orders}">
                                                    <td class="dtr-control sorting_1" tabindex="0"
                                                        th:text="${order.getId()}"></td>
                                                    <td th:text="${order.getNgayDatHang()}"></td>
                                                    <!--                                                    <td th:text="${order.getTongTien()}"></td>-->
                                                    <td th:text="${#numbers.formatDecimal(order.getTongTien(), 3, 'COMMA', 0, 'POINT') + ' VND'}"
                                                        class="text-right"></td>
                                                    <td th:text="${order.getTrangThai()}"></td>
                                                    <td th:text="${order.getKhachHang().getTenKH()}"></td>
                                                    <td>
                                                                <span th:if="${order.getKhuyenMai() != null}"
                                                                      th:text="${order.getKhuyenMai().getTenKhuyenMai()}"></span>
                                                        <span
                                                                th:if="${order.getKhuyenMai() == null}">Không</span>
                                                    </td>
                                                    <td style="text-align: center; vertical-align: middle;">
                                                        <a class="btn btn-primary"
                                                           onclick="handleDetailClick(this)"
                                                           th:data-id="${order.getId()}">Chi tiết</a>
                                                    </td>
                                                </tr>
                                                </tbody>
                                                <tfoot>

                                                </tfoot>
                                            </table>
                                        </div>
                                    </div>
                                    <div class="row"
                                         style="display: flex;justify-content: space-between;align-items: center;">
                                        <div class="col-sm-12 col-md-5">
                                            <div class="dataTables_info" id="example2_info" role="status"
                                                 aria-live="polite">
                                            </div>
                                        </div>
                                        <div class="col-sm-12 col-md-7"
                                             style="display: flex;justify-content: flex-end">
                                            <div class="dataTables_paginate paging_simple_numbers"
                                                 id="example2_paginate">
                                                <ul class="pagination" th:if="${totalPage > 0}">
                                                    <li class="paginate_button page-item previous"
                                                        th:if="${currentPage > 1}">
                                                        <a th:href="@{${keyword != null && keyword!='' ? '?keyword='+keyword+'&':'?'}+'pageNo='+ ${currentPage - 1}}"
                                                           class="page-link">Previous</a>
                                                    </li>
                                                    <li class="paginate_button page-item "
                                                        th:each="i:${#numbers.sequence(1,totalPage)}"
                                                        th:classappend="${currentPage == i ? 'active' : '' }">
                                                        <a th:href="@{${keyword != null && keyword!='' ? '?keyword='+keyword+'&':'?'}+'pageNo='+${i}}"
                                                           class="page-link" th:text="${i}"></a>
                                                    </li>
                                                    <li class="paginate_button page-item next"
                                                        th:if="${currentPage < totalPage}">
                                                        <a th:href="@{${keyword != null && keyword!='' ? '?keyword='+keyword+'&':'?'}+'pageNo='+${currentPage + 1}}"
                                                           class="page-link">Next</a>
                                                    </li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- /.card-body -->
                        </div>
                        <!-- /.card -->
                    </div>
                    <!-- /.col -->
                </div>
            </div>
        </section>
        <!-- /.content -->
    </div>

    <!-- /.content-wrapper -->
    <footer th:replace="admin/fragments/footer :: footer"></footer>

    <!-- Control Sidebar -->
    <aside class="control-sidebar control-sidebar-dark">
        <!-- Control sidebar content goes here -->
    </aside>
    <!-- /.control-sidebar -->

</div>
<!-- ./wrapper -->
<!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="myModalLabel">CHI TIẾT ĐƠN HÀNG</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- ./Modal -->
<script>
    function handleDetailClick(id) {
        var orderID = $(id).data('id');
        $.ajax({
            url: 'http://localhost:9090/admin/order/detail/' + orderID,
            method: 'GET',
            success: function (res) {
                $('#myModal .modal-body').html(res);
            },
            error: function (err) {
                alert('Có lỗi xảy ra');
            }
        });
        $('#myModal').modal('show');
    }
</script>

<!-- jQuery -->
<div th:replace="admin/fragments/script :: script"></div>
</body>

</html>